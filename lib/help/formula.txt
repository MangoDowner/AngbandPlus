FORMULAS GUIDE
----------------

Last Update: Portralis 0.5

This document explains how various values are calculated. This will
help you build a better character out of these formulas. Note
that these are basic formulas, and can be altered by items and
abilities.

Most combat and damages formulas apply to both players and monsters.

ROLLS

May of the formulas below uses the term "roll". A roll consists in
a number randomly chosen between 1 and whatever maximum value the roll
may have. So for example, if you have something like this:

Player's roll: (Fighting)
Monster's roll: (Evasion)

This means that both the player and the monster will roll a number between
1 and the maximum value of either Fighting or Evasion. Whoever has the
highest number wins the roll. In case of an equal roll, the one who initiated
the action will have priority. For example, if the player attacks the monster,
the monster tries to dodge, and the rolls are equal, the player will win and
will hit the monster. Similarly, if the monster is the attacker, and the rolls
are equal, the monster will hit the player.



MELEE/THROWING DAMAGES

Damages = Base weapon/unarmed damages roll +
          ((base weapon/unarmed damages roll) * (Strength-5))

Unarmed damages starts at 1d3, and increases by 1d1 for every 40 points
in Martial Arts, or 80 points in Fighting.

Note that when using two-handed melee weapons, the base roll is increased
by 33%. The same bonus apply if you wield a weapon that can be held with
either one or two hands with both hands.

Passive bonus to damages are applied to the calculated Damages.

RANGED DAMAGES

Damages = Base ranged damages roll +
          ((base ranged damages roll) * (Dexterity-5))

Passive bonus to damages are applied to the calculated Damages.

SPELLS DAMAGES/HEALING POWER:

Power = ((Spell's power) * (casting stat - 5))

Where (casting stat) is either Intelligence or Wisdom(or even Charisma for
the Music skill), depending on the situation.

Passive bonus to damages are applied to the calculated Power. Note that
as of 0.5, to_d bonus is now added to magic damages.


MELEE/RANGED DAMAGES MITIGATION:

Reduction = 100 - (((Attacker's skill) / ((Attacker's skill) +
            (Defender's AC))) * 100)

So if you get attacked by a monster with an attack skill of 50, and your
AC is 150, the reduction will be
100 - ((50/200) * 100) = 100 - 25 = 75% damages reduction.

On the other hand, if you get attacked by a monster with a skill of 300
versus an AC of only 40, the reduction would be
100 - ((300/340)*100) = 100 - 88 = 12% damages reduction.

Therefore, having a high AC is very important, or you will end up taking
much damages from enemy attacks.

MAGIC DAMAGES MITIGATION:

Reduction = 100 - (((Attacker's skill) / ((Attacker's skill) +
            (Defender's mdef))) * 100)

Essentially the same formula as the one for melee and ranged damages, but
uses a different value.

Enemy monsters have a "mdef" skill that is used for damages mitigation.

For players, however, "mdef" is equal to your Magic Defense skill * 3.
So if your Magic Defense skill is 30, your "mdef" will be 90 for the
purpose of damages mitigation.


BLOCKING CHANCES

You will be able to get a chance to block incoming melee and ranged
attacks if you wield an items that has base AC. A shield has base
AC and is the main piece of equipment that you will use to enable
blocking. However, certain weapons also have base AC, and if you
use one, you will get a chance to block.

The roll to determine if you block an incoming attack:

Your roll: (Strength + Defense skill + shield/item's base AC) vs

Monster's roll: (Strength + Attack Skill)

You will also receive a percentile bonus to your roll equal to the
base AC bonus of the items that you wield(if you wield two shields,
for example, the percentile is an addition of both shields' AC). If
you win the roll, you block the attack and take no damages.


To roll to determine whether a monster blocks your attacks:

Monster's roll: (Strength + Attack Skill)
Your roll: (Dexterity + Skills + to_h bonus)

Note that not all monsters are capable of blocking attacks. Only those
with the appropriate counters will be able to get a chance to block.


WISDOM-BASED SPELLCASTING SUCCESS RATE:

Wisdom spellcasting costs no mana, but the spells may fail. To determine
whether or not you fail casting, it depends on the cost of the spell versus
how much wisdom you have. Here's the three possible scenarios:

Wisdom >= (Spell's cost - Wisdom): The spell has 100% success rate.

Spell's cost > Wisdom: There is a roll between the spell's cost and your
                       wisdom. The roll is:

                       (Wisdom) vs (Spell's cost - Wisdom)

                       If you win the roll, you can cast the spell. If not, you
                       fail to cast the spell.

Spell's cost - Wisdom > (Wisdom * 5): The spell is too powerful to attempt, and you
                             cannot cast it.


HITTING AND DODGING

When you try hitting an enemy with a melee or ranged attack, the monster
will attempt to dodge your attack. The roll is:

Your roll: (Dexterity + Skill + to_h bonus)
Monster's roll: (Dexterity + Evasion)

"Skill" is the skill related to your attack(such as Fighting, Shooting or a
specialized weapon skill). If you win the roll, you will hit the monster.
Otherwise, it will dodge.

When a monster attacks you with a melee or ranged attack, you will also
attempt to dodge. The roll will be:

Monster's roll: (Dexterity + Attack Skill)
Your roll: (Dexterity + Agility)


HITTING WITH MAGIC, AND STOPPING MAGIC ATTACKS

The rolls for magic attacks are similar, except they are based on Magic Defense
and MDef. The formulas to hit a monster with a spell is:

Your roll: (Skill + to_h bonus)
Monster's roll: (MDef)

"Skill" is the skill related to your attack(such as Spellcraft, or a
specialized spell skill). If you win the roll, you will the monster.
Otherwise, it will stop the spell.

When a monster attacks you with a magic attack, you will also
attempt to stop the spell. The roll will be:

Monster's roll: (Magic Skill)
Your roll: (Magic Defense)

