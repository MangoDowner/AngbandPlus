<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<META NAME="Generator" CONTENT="Microsoft Word 97">
<TITLE>kangsysd</TITLE>
<META NAME="Template" CONTENT="C:\Program Files\Microsoft Office\Templates\Web Pages\Web Page Wizard.wiz">
</HEAD>
<BODY LINK="#0000ff" VLINK="#800080" BACKGROUND="Image3.gif">
<DIR>

<B><FONT FACE="Garamond" SIZE=7><P>Systems Documentation</P></DIR>

</B></FONT><FONT FACE="Courier New" SIZE=2><P>6/29/98- Kangband has changed so much that Systems Docs no longer really apply.  I will leave this information for anyone else curious about how to start developing a variant and where they may have to look to change items.  In the future, this page will deal with specific additions such as how I implemented plots or how pets work.</P>
<P>&nbsp;</P>
<P>This file has not been completely updated for Kangband 282c or 282d</P>
<P>&nbsp;</P>
<P>System's Documentation for Kangband</P>
<P>All changes will be marked in the source code with "-KMW-" inside a comment.</P>
<P>Source code changes:</P>
<P>- Removed load1.c from makefiles, externs.h, and references from save.c Renamed load2.c to load.c. Changed all appropriate references. Load1.c was deleted. This was done to save space on the executable and since kangband is not backwards compatible.</P>
<P>- Changed Makefile. Thise file should be changed per hardware configuration. It has nothing to do with this angband variation with the exception that bldg.c/bldg.o has to be included. I have included this file in all the makefile.xxx files in this package. The file h-config.h would also be changed based on hardware configuration.</P>
<P>- config.h: Currently, wizard commands and spoiler generation are enabled. Also, this variant will NOT parse old savefiles and as such, that option is disabled.</P>
<P>- defines.h: Added constants for the town, kobold race, illusionist class, increased f_idx size (for building doors), and poison &amp; venom attributes. Added in terrain flags and adjusted routines for line of sight, plain floor, etc. to take terrains into account. Also added various quest flags.</P>
<P>- externs.h: Added illusionist info to spell flags and names, added arena monster list definition, monster type in critical (for rogue hits), brand ammo function, high class/race functions, monster saves, fear spells, quest initialization function, building command, AND COMMENTED OUT USLEEP as it would not compile with it.</P>
<P>- h-config.h: Uncommented the DOS line for compilation.</P>
<P>- types.h: Added illusionist info, and town variables for player. Also added definitions for vaults and quests.</P>
<P>- birth.c: Added kobold race, town information, illusionist info, initialize rewards and quests.</P>
<P>- bldg.c: A NEW file which contains code to handle all building commands.</P>
<P>- cave.c: Modified the is_quest function to work with the new structure of quests.</P>
<P>- cmd1.c: Added monster sleep status to critical hit so rogues can always get critical when its asleep, added poison brand, building door code. Added code for terrains and quests.</P>
<P>- cmd2.c: enter building code. Also some code for terrains and quests.</P>
<P>- cmd4.c: replaced "angband" with "kangband". Added a function to check status of quests (Cntl-Q).</P>
<P>- cmd5.c: Added all the code for illusionist spells. I used the same area as the mage and only used if statements where the spell did differ. Also added brand ammo spell, brand weapon spell, to include poison/venom brand per GW-Angband.</P>
<P>- cmd6.c: brand bolts function merged with mage spell.</P>
<P>- dungeon.c: added illusionist info, reset rewards once/day, don't generate monsters in arena, enter building entry point, alter 'G' to visit tower or temple for spells. Disallow magic commands if in arena. Inserted command to check quest.</P>
<P>- files.c: added "kangband", new player fields, high scores to show if died in the arena, new show_highclass and race_legend functions for use in the town.</P>
<P>- generate.c: code to build the town and stores added, code to build arena. Also added in wilderness generation and quest placement.</P>
<P>- init1.c: code for poison brand, vault initialization, and quest initialization.</P>
<P>- init2.c: code to add illusion books to store. Also some code for vault and quest initialization.</P>
<P>- load2.c: code to load player town variables &amp; handle old files. (kang282b)</P>
<P>- melee2.c: monster code to make them non-helpless when stunned. Handled monster movement/attack over the various terrains.</P>
<P>- monster1.c: added confusion and sleep flags to correct spot.</P>
<P>- monster2.c: added monster saving throw function.</P>
<P>- object1.c: added illusion books, poison brand info.</P>
<P>- object2.c: poison brand info, *minor* variable change, venom weapon info, arrows/bolts good unless damaged, rod sorting code, illusion spell damage information. Handle objects dropping into shallow terrain.</P>
<P>- save.c: new player variables saved.</P>
<P>- spells1.c: added illusionist book code, chaos spell change, monster saving throws included.</P>
<P>- spells2.c: enchant_table_dam added, poison brand info, illusion book info, limit enchant to natural weapon damage, new fear spells, </P>
<P>- store.c: added kobold code, illusion book code, rod sorting routines, can't enter house until awarded it by the Lord of Castle.</P>
<P>- tables.c: altered dexterity table slightly, strength/weight table, blows table, added arena monster number list, kobold shop keeper, class tables to include illusionist (only human), illusionist class itself, illusion books and spells and titles.</P>
<P>- variable.c: arena_monster list definition, quest list.</P>
<P>- wizard1.c: illusion book code, poison brand, "kangband".</P>
<P>- wizard2.c: minor flag change, illusion book code, wiz command to mark all squares for debugging, and to complete quests.</P>
<P>- xtra1.c: sleep/fear added to monster health bar, illusion book code, kobold poison resistance, high level warriors fear resistance.</P>
<P>- xtra2.c: arena exiting code, building door code, quest completion.</P>
<P>=========================================================</P>
<P>The following files were NOT altered from Angband 2.8.2:</P>
<P>angband.h&#9;a-mac-h.pch&#9;main-emx.c&#9;main.c</P>
<P>h-basic.h&#9;a-win-h.pch&#9;main-gcu.c&#9;melee1.c</P>
<P>h-define.h&#9;&#9;&#9;main-ibm.c&#9;util.c</P>
<P>h-system.h&#9;a-mac-h.c&#9;main-mac.c&#9;z-form.c</P>
<P>h-type.h&#9;&#9;&#9;main-sla.c&#9;z-rand.c</P>
<P>z-form.h&#9;cmd3.c&#9;&#9;main-vme.c&#9;z-term.c</P>
<P>z-rand.h&#9;load1.c&#9;&#9;main-win.c&#9;z-util.c</P>
<P>z-term.h&#9;main-acn.c&#9;main-x11.c&#9;z-virt.c</P>
<P>z-util.h&#9;&#9;main-ami.c&#9;main-xaw.c</P>
<P>z-virt.h&#9;&#9;main-cap.c&#9;main-xxx.c</P>
<P>=========================================================</P>
<P>&nbsp;</P>
<P>Changes in LIB:</P>
<P>&nbsp;</P>
<P>In the EDIT folder:</P>
<P>a_info.txt: Rilia now has poison brand, Arunruth has cold brand, Ulmo now has correct weight (7-&gt;10lbs)</P>
<P>e_info.txt: "of Venom" weapon added</P>
<P>f_info.txt: building doors added, terrains added, quest features added</P>
<P>k_info.txt: illusionist books added</P>
<P>r_info.txt: the elemental spirits (with the exception of "named" ones) are not evil, not as many monsters can resist sleep and confusion.</P>
<P>v_info.txt: added quest levels. Also added many vaults from Zangband 2.0.6.</P>
<P>q_info.txt: NEW file. Contains quest details.</P>
</FONT><FONT FACE="Garamond"><P>&nbsp;</P><DIR>

</FONT><P><IMG SRC="Image5.gif" WIDTH=536 HEIGHT=5></P>
<P><A HREF="kangband.html">Main Page</A> | <A HREF="kangtodo.html"><B><FONT FACE="Arial" SIZE=2>To-Do List</B></FONT></A><B><FONT FACE="Arial" SIZE=2> | </B></FONT><A HREF="kangdocu.html"><B><FONT FACE="Arial" SIZE=2>Documentation</B></FONT></A><B><FONT FACE="Arial" SIZE=2> | </B></FONT><A HREF="kangdown.html"><B><FONT FACE="Arial" SIZE=2>Download Area</B></FONT></A><B><FONT FACE="Arial" SIZE=2> | </B></FONT><A HREF="kanglink.html"><B><FONT FACE="Arial" SIZE=2>Links</B></FONT></A></P></DIR>
</BODY>
</HTML>
